
<head>
    <meta charset="utf-8">

    <title>Hacking NFC cards</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <link rel="shortcut icon" href="../../favicon.png">

    <link rel="shortcut icon" href="../../favicon.png" type="image/png">
    <link rel="canonical" href="../index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="moorada tells things">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Hacking NFC cards">
    <meta property="og:description" content="It is certainly not the first article on this topic and probably not the last either, but I have noticed that in the various articles there is always something missing or taken for granted.  In this article I would also like to tell about my particular journey. Goal The goal">
    <meta property="og:url" content="http://localhost:2368/hacking-nfc-card/">
    <meta property="og:image" content="http://localhost:2368/content/images/2020/02/access-card-4575613_1920.jpg">
    <meta property="article:published_time" content="2020-02-29T22:31:01.000Z">
    <meta property="article:modified_time" content="2020-02-29T23:47:09.000Z">
    <meta property="article:tag" content="hacking">
    <meta property="article:tag" content="nfc">
    <meta property="article:tag" content="mifare">
    <meta property="article:tag" content="crack">
    <meta property="article:tag" content="rfid">
    <meta property="article:tag" content="tag">
    <meta property="article:tag" content="miLazyCracker">
    <meta property="article:tag" content="kali-linux">
    <meta property="article:tag" content="mfoc">
    <meta property="article:tag" content="card">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Hacking NFC cards">
    <meta name="twitter:description" content="It is certainly not the first article on this topic and probably not the last either, but I have noticed that in the various articles there is always something missing or taken for granted.  In this article I would also like to tell about my particular journey. Goal The goal">
    <meta name="twitter:url" content="http://localhost:2368/hacking-nfc-card/">
    <meta name="twitter:image" content="http://localhost:2368/content/images/2020/02/access-card-4575613_1920.jpg">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="moorada">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="hacking, nfc, mifare, crack, rfid, tag, miLazyCracker, kali-linux, mfoc, card">
    <meta property="og:image:width" content="1920">
    <meta property="og:image:height" content="1280">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "moorada tells things",
        "logo": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/favicon.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "moorada",
        "image": {
            "@type": "ImageObject",
            "url": "http://localhost:2368/content/images/2020/02/moorada-2.jpg",
            "width": 640,
            "height": 640
        },
        "url": "http://localhost:2368/author/moorada/",
        "sameAs": []
    },
    "headline": "Hacking NFC cards",
    "url": "http://localhost:2368/hacking-nfc-card/",
    "datePublished": "2020-02-29T22:31:01.000Z",
    "dateModified": "2020-02-29T23:47:09.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "http://localhost:2368/content/images/2020/02/access-card-4575613_1920.jpg",
        "width": 1920,
        "height": 1280
    },
    "keywords": "hacking, nfc, mifare, crack, rfid, tag, miLazyCracker, kali-linux, mfoc, card",
    "description": "It is certainly not the first article on this topic and probably not the last either, but I have noticed that in the various articles there is always something missing or taken for granted.  In this article I would also like to tell about my particular journey. Goal The goal",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://localhost:2368/"
    }
}
    </script>

    <meta name="generator" content="Ghost 1.26">
    <link rel="alternate" type="application/rss+xml" title="moorada tells things" href="../../rss/index.html">

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,600,400">
    <style amp-custom>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{margin:0.67em 0;font-size:2em}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{position:relative;vertical-align:baseline;font-size:75%;line-height:0}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}amp-img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em;border:1px solid #c0c0c0}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{max-height:100%;height:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0)}body{max-height:100%;height:100%;color:#3a4145;background:#f4f8fb;letter-spacing:0.01rem;font-family:"Merriweather", serif;font-size:1.8rem;line-height:1.75em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{margin:0 0 0.3em 0;color:#2e2e2e;font-family:"Open Sans", sans-serif;line-height:1.15em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-moz-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-o-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1}h1{text-indent:-2px;letter-spacing:-1px;font-size:2.6rem}h2{letter-spacing:0;font-size:2.4rem}h3{letter-spacing:-0.6px;font-size:2.1rem}h4{font-size:1.9rem}h5{font-size:1.8rem}h6{font-size:1.8rem}a{color:#4a4a4a}a:hover{color:#111}p,ul,ol,dl{margin:0 0 2.5rem 0;font-size:1.5rem;text-rendering:geometricPrecision;-webkit-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-moz-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-o-font-feature-settings:"liga" 1, "onum" 1, "kern" 1}ol,ul{padding-left:2em}ol ol,ul ul,ul ol,ol ul{margin:0 0 0.4em 0;padding-left:2em}dl dt{float:left;clear:left;overflow:hidden;margin-bottom:1em;width:180px;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd{margin-bottom:1em;margin-left:200px}li{margin:0.4em 0}li li{margin:0}hr{display:block;margin:1.75em 0;padding:0;height:1px;border:0;border-top:#efefef 1px solid}blockquote{box-sizing:border-box;margin:1.75em 0 1.75em 0;padding:0 0 0 1.75em;border-left:#4a4a4a 0.4em solid;-moz-box-sizing:border-box}blockquote p{margin:0.8em 0;font-style:italic}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;color:#ccc;font-size:0.9em}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:normal}mark{background-color:#fdffb6}code,tt{padding:1px 3px;border:#e3edf3 1px solid;background:#f7fafb;border-radius:2px;white-space:pre-wrap;font-family:Inconsolata, monospace, sans-serif;font-size:0.85em;font-feature-settings:"liga" 0;-webkit-font-feature-settings:"liga" 0;-moz-font-feature-settings:"liga" 0}pre{overflow:auto;box-sizing:border-box;margin:0 0 1.75em 0;padding:10px;width:100%;border:#e3edf3 1px solid;background:#f7fafb;border-radius:3px;white-space:pre;font-family:Inconsolata, monospace, sans-serif;font-size:0.9em;-moz-box-sizing:border-box}pre code,pre tt{padding:0;border:none;background:transparent;white-space:pre-wrap;font-size:inherit}kbd{display:inline-block;margin-bottom:0.4em;padding:1px 8px;border:#ccc 1px solid;background:#f4f4f4;border-radius:4px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 0 #fff inset;color:#666;text-shadow:#fff 0 1px 0;font-size:0.9em;font-weight:700}table{box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%;background-color:transparent;-moz-box-sizing:border-box}table th,table td{padding:8px;border-top:#efefef 1px solid;vertical-align:top;text-align:left;line-height:20px}table th{color:#000}table caption + thead tr:first-child th,table caption + thead tr:first-child td,table colgroup + thead tr:first-child th,table colgroup + thead tr:first-child td,table thead:first-child tr:first-child th,table thead:first-child tr:first-child td{border-top:0}table tbody + tbody{border-top:#efefef 2px solid}table table table{background-color:#fff}table tbody > tr:nth-child(odd) > td,table tbody > tr:nth-child(odd) > th{background-color:#f6f6f6}table.plain tbody > tr:nth-child(odd) > td,table.plain tbody > tr:nth-child(odd) > th{background:transparent}iframe,amp-iframe,.fluid-width-video-wrapper{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper amp-iframe{margin:0}textarea,select,input{margin:0 0 5px 0;padding:6px 9px;width:260px;outline:0;border:#e7eef2 1px solid;background:#fff;border-radius:4px;box-shadow:none;font-family:"Open Sans", sans-serif;font-size:1.6rem;line-height:1.4em;font-weight:100;-webkit-appearance:none}textarea{min-width:250px;min-height:80px;max-width:340px;width:100%;height:auto}input[type="text"]:focus,input[type="email"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="number"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,textarea:focus{outline:none;outline-width:0;border:#bbc7cc 1px solid;background:#fff}select{width:270px;height:30px;line-height:30px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.main-header{position:relative;display:table;overflow:hidden;box-sizing:border-box;width:100%;height:50px;background:#5ba4e5 no-repeat center center;background-size:cover;text-align:left;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.content{background:#fff;padding-top:15px}.blog-title,.content{margin:auto;max-width:600px}.blog-title a{display:block;padding-right:16px;padding-left:16px;height:50px;color:#fff;text-decoration:none;font-family:"Open Sans", sans-serif;font-size:16px;line-height:50px;font-weight:600}.post{position:relative;margin-top:0;margin-right:16px;margin-left:16px;padding-bottom:0;max-width:100%;border-bottom:#ebf2f6 1px solid;word-wrap:break-word;font-size:0.95em;line-height:1.65em}.post-header{margin-bottom:1rem}.post-title{margin-bottom:0}.post-title a{text-decoration:none}.post-meta{display:block;margin:3px 0 0 0;color:#9eabb3;font-family:"Open Sans", sans-serif;font-size:1.3rem;line-height:2.2rem}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.post-meta .author{margin:0;font-size:1.3rem;line-height:1.3em}.post-date{display:inline-block;text-transform:uppercase;white-space:nowrap;font-size:1.2rem;line-height:1.2em}.post-image{margin:0;padding-top:3rem;padding-bottom:30px;border-top:1px #E8E8E8 solid}.post-content amp-img,.post-content amp-anim{position:relative;left:50%;display:block;padding:0;min-width:0;max-width:112%;width:calc(100% + 32px);height:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}.footnotes{font-size:1.3rem;line-height:1.6em;font-style:italic}.footnotes li{margin:0.6rem 0}.footnotes p{margin:0}.footnotes p a:last-child{text-decoration:none}.site-footer{position:relative;margin:0 auto 20px auto;padding:1rem 15px;max-width:600px;color:rgba(0,0,0,0.5);font-family:"Open Sans", sans-serif;font-size:1.1rem;line-height:1.75em}.site-footer a{color:rgba(0,0,0,0.5);text-decoration:none;font-weight:bold}.site-footer a:hover{border-bottom:#bbc7cc 1px solid}.poweredby{display:block;float:right;width:45%;text-align:right}.copyright{display:block;float:left;width:45%}</style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="../../">moorada tells things</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Hacking NFC cards</h1>
                <section class="post-meta">
                    <p class="author">by <a href="../../author/moorada/">moorada</a></p>
                    <time class="post-date" datetime="2020-02-29">2020-02-29</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="http://localhost:2368/content/images/2020/02/access-card-4575613_1920.jpg" width="600" height="400" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <div class="kg-card-markdown"><p>It is certainly not the first article on this topic and probably not the last either, but I have noticed that in the various articles there is always something missing or taken for granted.  In this article I would also like to tell about my particular journey.</p>
<h1 id="goal">Goal</h1>
<p>The goal is to describe the process of hacking an NFC cards.<br>
These cards are used for access control in various fields (bus, car keys, hotel). In my specific case it is a laundry card for the use of washing machines and dryers on my university campus and my goal is to change the balance on my card.<br>
First of all, there are more types of cards and the one I will go into today are the most widespread, as well as the cheapest and vulnerable. I'm talking about MIFARE high-frequency NFC cards, in fact they were exploited more than 10 years ago but are still widely used.</p>
<h1 id="whatyouneed">What you need</h1>
<ul>
<li>NFC reader/writer (PN531/532/533). You can easily find it on the internet. I used ACR122U.</li>
<li>Kali Linux (it's not necessary but it makes it easier). You can run it "live" from a USB drive (<a href="https://www.kali.org/docs/usb/kali-linux-live-usb-install/">guide</a>). Alternatively you can use some linux distro.</li>
</ul>
<h1 id="letsdo">Let's do</h1>
<p>First let's start Kali Linux and connect to the internet. Open the terminal and execute the following commands.</p>
<pre><code>sudo su
apt update
apt install libnfc-bin
apt install mfoc
git clone https://github.com/nfc-tools/miLazyCracker
</code></pre>
<p>Now let's go into the "miLazyCracker" folder and edit the file "miLazyCrackerFreshInstall.sh" with any text editor.<br>
You have to replace the lines:</p>
<pre><code>[ -f craptev1-v1.1.tar.xz ] || wget http://www2.vaneay.fr/mifare/craptev1-v1.1.tar.xz
[ -f crapto1-v3.3.tar.xz ] || wget http://www2.vaneay.fr/mifare/crapto1-v3.3.tar.xz
</code></pre>
<p>to</p>
<pre><code>[ -f craptev1-v1.1.tar.xz ] || wget http://privat.bahnhof.se/wb736562/rfid/crypto1/craptev1-v1.1.tar.xz
[ -f crapto1-v3.3.tar.xz ] || wget http://privat.bahnhof.se/wb736562/rfid/crypto1/crapto1-v3.3.tar.xz
</code></pre>
<p>save and close!</p>
<p>Now plug in your NFC reader and run</p>
<pre><code>modprobe -r pn533_usb
</code></pre>
<p>Install miLazyCracker</p>
<pre><code>./miLazyCrackerFreshInstall.sh
</code></pre>
<p>Now you can run the program</p>
<pre><code>miLazyCracker
</code></pre>
<p>Now the program starts "brute-force" (It's not pure brute-force, but exploits a vulnerability) on the keys of the card sectors. Don't worry if it takes a while. It's normal for it to take about 10-60 minutes.</p>
<p>Finally the program dumps the card to file *.mfd and asks if you want to clone.  If you want to clone to another tag immediately, exchange the tag on the reader with the new tag and submity y, otherwise submit n.</p>
<p>At this point you have your card dump, you can restore your card at this time as many times as you want or clone it to other cards.<br>
For example, if the card has a balance of $50, you can use up the credit and then restore it to its dump state with the balance of $50.<br>
If you want to write the dump:</p>
<pre><code>nfc-mfclassic w a dump.mfd dump.mfd
</code></pre>
<h2 id="letsdobetter">Let's do better</h2>
<p>Honestly, that's not good enough for me. So I tried to read and understand the various sectors of the dump to understand their meaning and try to change the balance.<br>
A great program to view and edit dumps is 010Editor available <a href="https://www.sweetscape.com/download/010editor/">here<br>
</a>.</p>
<p>After installing it, you can open the dump.mfd and view its contents. You will see a lot of values in hexadecimal format.  There are 16 sectors and each sector consists of 4 lines. In the first 2 sectors there is usually information about the card or company that produced it, and the last line of each sector corresponds to the reading and writing keys of each sector.</p>
<h3 id="findthebalance">Find the balance</h3>
<p>The goal is to make sense of these bytes in order to figure out what to change.<br>
To do this you can look for some specific value.  Obviously all bytes are presented in hexadecimal so it would make no sense to look for your balance in decimal form. I, for example, knowing my balance, started with this. My balance was $14.00 so I started by converting 1400 into hexadecimal. If you don't know how to convert it or you don't like it you can use a converter (it won't be hard to find it on the web).</p>
<p><em>1400 --&gt; <strong>0578</strong></em>.</p>
<p>Searching the dump values I found the same inverted values in the first two bytes of the second line of the third sector. Intuitively I saw the similarity with the first line and doing the inverse transaction I noticed that it corresponds to the balance before the last transaction (16$)</p>
<pre><code>40 06 00 00 00 00 00 00 00 00 11 02 14 00 47 90
78 05 00 00 00 00 00 00 00 00 11 02 14 01 32 13
</code></pre>
<p>So I tried to change the value to another balance ($60) like this:</p>
<p><em>6000 --&gt; <strong>003C</strong></em>.</p>
<pre><code>40 06 00 00 00 00 00 00 00 00 11 02 14 00 47 90
70 17 00 00 00 00 00 00 00 01 11 02 14 01 32 13
</code></pre>
<p>I saved and wrote the modified dump on the card...</p>
<pre><code>nfc-mfclassic w a editedDump.mfd editedDump.mfd
</code></pre>
<p>I tried the card in the laundry room, but <em><strong>"din din din din!"</strong></em> and red light was the reply. Apparently, the washing machine detected something weird!</p>
<p>Apparently, the washing machine picked up something weird. So I rewrote the card with the dump unmodified and re-tested the card.Everything worked properly!</p>
<h3 id="reversethechecksum">Reverse the checksum</h3>
<p>That made me realize there's some kind of cheksum, so I tried to figure out what the other bytes meant. Since I did another transaction with the card and the credit should be changed, I reread the card to see if there was any change. This time I didn't use myLazyCracker, since I know the keys, but simply:</p>
<pre><code>nfc-mfclassic r a input.mfd output.mfd
</code></pre>
<p>where "input.mfd" corresponds to the previously made dump (containing the read and write keys) , and "output.mfd" corresponds to the name of the new dump</p>
<p>No sector except the third one has changed! In fact, only the first two lines of the third sector have changed...</p>
<pre><code>78 05 00 00 00 00 00 00 00 00 11 02 14 01 32 13
B0 04 00 00 00 00 00 00 00 00 38 02 14 01 7D 4A
</code></pre>
<p>And it is immediately noticeable that the second line has become the first line and the bytes in position 11-13, which before were equal between the two lines, have now changed.</p>
<p>After having translated them into decimal it was easy to understand that these values corresponded to the date when the transaction was done. The value at position 14 could be a daily operations counter. But the last two bytes are completely anonymous. Those two bytes are probably checksums of some kind.</p>
<p>So I try to see if they are the result of some operation (XOR,OR,AND,+,-,*,/) on the other bytes, but I don't find any matching value (I still suggest you try your dump). I don't get down, I look for some checksum note functions on the web, until I try the cyclic redundancy check (CRC).</p>
<p>There are many types of algorithms for CRC, so I look for a computer online, and I find <a href="https://crccalc.com/">this great site</a> that allows you to calculate the most famous CRC algorithms.</p>
<p></p>
<p>So I entered all the bytes of a line except the last two and clicked on "Calc CRC-16" because in my case the checksum was probably 2 bytes, so 16 bits. You can try different and more appropriate types of CRC. Anyway on the site is shows the list of cheksum and... <em><strong>Kaboom!</strong></em> Here is the correct checksum!</p>
<p></p>
<p>Once I found the right checksum I just had to change the balance, calculate the checksum (in my case CRC-16/MCRF4XX ) and rewrite the whole line like this</p>
<pre><code>70 17 00 00 00 00 00 00 00 00 38 02 14 01 EB DB
</code></pre>
<p>And that’s it!</p>
</div>

            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="../../">moorada tells things</a> © 2020</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
